<!doctype html>
<html lang="es">
<head>
  <meta charset="utf-8">
  <title>Lecci√≥n 5 ‚Äì Presi√≥n tras p√©rdida</title>
  <meta name="viewport" content="width=device-width,initial-scale=1">
  <style>
    body{background:#1b263b;color:#ffff00;padding:25px;font-family:Segoe UI,system-ui,sans-serif}
    h3{color:#00ff00;margin-bottom:15px}
    .card{background:#415a77;border-radius:12px;padding:15px;margin:10px 0}
    .btn{background:#00ff00;color:#1b263b;border:none;padding:8px 12px;border-radius:6px;cursor:pointer;font-weight:bold}
    .btn:hover{background:#ffff00}
    .alert-success{color:#00ff00;text-align:center;padding:20px;background:#28a745;border-radius:8px;margin-top:15px}
    .alert-warning{color:#ffcc00;text-align:center;padding:20px;background:#ffc107;color:#000;border-radius:8px;margin-top:15px}
    label{display:block;margin:6px 0;cursor:pointer}
    input{margin-right:8px}
  </style>
</head>
<body>

<div style="background:#1b263b;color:#ffff00;padding:25px;border-radius:12px;font-family:Segoe UI,system-ui,sans-serif;">
  <h3>Lecci√≥n 5: Presi√≥n tras p√©rdida</h3>

  <p>
    La presi√≥n tras p√©rdida es el primer acto defensivo y el √∫ltimo acto ofensivo: en tres segundos el bal√≥n debe estar otra vez bajo nuestro control o al menos lejos de la zona caliente. Obligamos al rival hacia la banda, cerramos l√≠neas de pase con cuerpo y voz, y todos corren con la misma referencia: bal√≥n, espaldas de la defensa y compa√±eros. Si uno falla, el sistema colapsa; si todos aciertan, el estadio respira con nosotros.
  </p>

  <h4>Claves que marca el cuerpo t√©cnico</h4>
  <ul>
    <li>Primer paso: sprint al bal√≥n.</li>
    <li>Segundo paso: cerrar espacios interiores.</li>
    <li>Tercer paso: comunicaci√≥n constante (grito de ‚Äú¬°Presiona!‚Äù).</li>
    <li>Cuarto paso: fuerza al rival hacia la banda.</li>
    <li>Quinto paso: si no recuperas en 5 segundos, repliega ordenado.</li>
  </ul>

  <h4>Ejercicio pr√°ctico</h4>
  <ol>
    <li>Simula p√©rdida en campo reducido.</li>
    <li>El equipo m√°s cercano al bal√≥n activa la presi√≥n.</li>
    <li>El resto cierra l√≠neas de pase y empuja al rival a la banda.</li>
    <li>Conteo en voz alta: ‚Äúuno-dos-tres‚Äù.</li>
    <li>Si no se recupera, retrocede 5 metros y compacta.</li>
  </ol>

  <button class="btn" onclick="iniciarTest()">Iniciar test</button>
  <div id="testArea"></div>
  <div id="resultArea"></div>
</div>

<script>
const preguntas = [
  { pregunta: "¬øCu√°ntos segundos tiene el equipo para presionar tras la p√©rdida?", opciones: ["1", "3", "5", "10"], correcta: 1 },
  { pregunta: "¬øQu√© se debe cerrar primero?", opciones: ["El bal√≥n", "Las l√≠neas de pase", "El √°rbitro", "La banda"], correcta: 1 },
  { pregunta: "¬øQui√©n participa en la presi√≥n?", opciones: ["Solo el que perdi√≥", "Todos", "Solo los defensas", "Solo los delanteros"], correcta: 1 },
  { pregunta: "¬øHacia d√≥nde se fuerza al rival?", opciones: ["Centro", "Banda", "√Årea propia", "Esquina"], correcta: 1 },
  { pregunta: "¬øQu√© se evita principalmente?", opciones: ["Pase interior", "Saque de meta", "Falta", "Corner"], correcta: 0 },
  { pregunta: "¬øQu√© tan importante es la comunicaci√≥n vocal?", opciones: ["Nada", "Poco", "Muy", "Solo para el capit√°n"], correcta: 2 },
  { pregunta: "Si no presionas, ¬øqu√© ocurre?", opciones: ["Nada", "Contraataque rival", "Falta", "Gol autom√°tico"], correcta: 1 },
  { pregunta: "¬øC√≥mo se llama en ingl√©s esta acci√≥n?", opciones: ["Offside", "Counter press", "Free kick", "Throw-in"], correcta: 1 },
  { pregunta: "¬øQu√© se debe evitar al presionar?", opciones: ["Velocidad", "Desorganizaci√≥n", "Intensidad", "Coordinaci√≥n"], correcta: 1 },
  { pregunta: "Clave del √©xito seg√∫n los t√©cnicos:", opciones: ["Suerte", "Actitud y coordinaci√≥n", "Fuerza", "Individualidad"], correcta: 1 }
];

let aciertos = 0;
let index = 0;

function iniciarTest() {
  aciertos = 0;
  index = 0;
  mostrarPregunta();
}

function mostrarPregunta() {
  const area = document.getElementById("testArea");
  if (index >= preguntas.length) { finalizar(); return; }
  const p = preguntas[index];
  let html = `<h4>Pregunta ${index + 1}/10</h4><p>${p.pregunta}</p>`;
  p.opciones.forEach((op, i) => {
    html += `<label><input type="radio" name="resp" value="${i}"> ${op}</label><br>`;
  });
  html += `<button class="btn" onclick="verificar()">Siguiente</button>`;
  area.innerHTML = html;
}

function verificar() {
  const sel = document.querySelector('input[name="resp"]:checked');
  if (!sel) return alert("Selecciona una opci√≥n");
  if (parseInt(sel.value) === preguntas[index].correcta) aciertos++;
  index++;
  mostrarPregunta();
}

async function finalizar() {
  const total = preguntas.length;
  const resultArea = document.getElementById("resultArea");
  
  if (aciertos === total) {
    // ‚úÖ OBTENER jugador_id DE LA URL
    const urlParams = new URLSearchParams(window.location.search);
    const jugadorId = urlParams.get('jugador_id');
    
    if (!jugadorId) {
      resultArea.innerHTML = `
        <div class="alert-warning">
          <h4>‚ùå Error</h4>
          <p>No se encontr√≥ el ID del jugador. Cerr√° y volv√© a ingresar tu c√©dula.</p>
        </div>
      `;
      return;
    }
    
    // GUARDAR EN BASE DE DATOS
    try {
      const res = await fetch("/guardar_aprobacion_pg", {
        method: "POST",
        headers: { "Content-Type": "application/json" },
        body: JSON.stringify({
          jugador_id: parseInt(jugadorId),
          leccion_numero: 5,
          nota: aciertos
        })
      });
      
      const data = await res.json();
      
      if (data.status === 'ok') {
        // ‚úÖ MOSTRAR √âXITO Y BOT√ìN PARA AVANZAR
        resultArea.innerHTML = `
          <div class="alert-success">
            <h2>üéâ ¬°Felicitaciones!</h2>
            <p style="font-size:20px;">Aprobaste con ${aciertos}/${total}</p>
            <p>Lecci√≥n 5 completada correctamente.</p>
            <button class="btn" style="font-size:18px;margin-top:15px;background:#00ff00;color:#1b263b;border:none;padding:12px 24px;border-radius:8px;cursor:pointer;" onclick="siguienteLeccion()">
              Continuar a Lecci√≥n 6 ‚Üí
            </button>
          </div>
        `;
      } else {
        throw new Error(data.msg || 'Error al guardar');
      }
    } catch (err) {
      resultArea.innerHTML = `
        <div class="alert-warning">
          <h4>‚ö†Ô∏è Error al guardar</h4>
          <p>${err.message}</p>
          <button class="btn" onclick="location.reload()">Reintentar</button>
        </div>
      `;
    }
    
  } else {
    // ‚ùå NO APROB√ì
    resultArea.innerHTML = `
      <div class="alert-warning">
        <h3>No aprobaste</h3>
        <p style="font-size:18px;">Obtuviste ${aciertos}/${total}</p>
        <p>Necesit√°s 10/10 para aprobar.</p>
        <button class="btn" style="background:#dc3545;color:white;margin-top:15px;" onclick="location.reload()">
          ‚Üª Reintentar Lecci√≥n
        </button>
      </div>
    `;
  }
}

// ‚úÖ FUNCI√ìN CLAVE: AVANZAR A SIGUIENTE LECCI√ìN
function siguienteLeccion() {
  // Enviar mensaje al padre (app.py) para que abra la siguiente lecci√≥n autom√°ticamente
  if (window.parent !== window) {
    window.parent.postMessage({
      tipo: 'leccion_aprobada',
      leccion: 5,
      nota: aciertos
    }, '*');
  }
}
</script>

</body>
</html>