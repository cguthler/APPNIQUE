<!doctype html>
<html lang="es">
<head>
  <meta charset="utf-8">
  <title>Lecci√≥n 2 ‚Äì Pase interior</title>
  <meta name="viewport" content="width=device-width,initial-scale=1">
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet">
  <style>
    body{background:#1b263b;color:#ffffff;font-family:Segoe UI,system-ui,sans-serif}
    .ventana{background:#1b263b;border-radius:12px;padding:20px;color:#ffff00}
    .btn-leer{background:#415a77;color:#ffff00;border:none;padding:10px 18px;border-radius:8px;cursor:pointer;font-size:15px}
    .btn-leer:hover{background:#5a7fb0}
    .timer-bar{width:100%;height:6px;background:#eee;margin-bottom:8px}
    .timer-fill{height:100%;background:#0d6efd;transition:width 1s linear}
    .ventana{max-height:70vh;overflow-y:auto;padding:15px}
    #testArea{max-height:60vh;overflow-y:auto}
    .opcion{margin:8px 0;padding:10px;background:#2a3f5f;border-radius:5px;cursor:pointer}
    .opcion:hover{background:#3a5070}
    .opcion input{margin-right:10px}
  </style>
</head>
<body class="p-4">

<div class="ventana" style="max-width:700px;margin:auto">
  <h4>Lecci√≥n 2: Pase interior ‚Äì precisi√≥n y ritmo</h4>
  <div class="mt-3 p-3 bg-dark rounded small">
    <p>
      El <strong>pase interior</strong> es la base de la posesi√≥n. Se ejecuta con la parte interna del pie dominante, tobillo firme, cuerpo ligeramente inclinado hacia adelante y rodilla de la pierna de apoyo flexionada.<br><br>

      <strong>T√©cnica clave:</strong><br>
      - Apoy√° el pie no pateador al costado del bal√≥n.<br>
      - Gir√° el tobillo hacia afuera para que la cara interna quede paralela al objetivo.<br>
      - Pegale al centro del bal√≥n; si lo haces muy abajo lo levant√°s, muy arriba lo clav√°s.<br>
      - Segu√≠ el movimiento: el pie debe salir hacia el compa√±ero, no hacia arriba.<br><br>

      <strong>Tipos de pase interior:</strong><br>
      - <em>Fijo:</em> pie plantado, sin finta, ideal cuando ten√©s tiempo.<br>
      - <em>En movimiento:</em> se hace mientras corr√©s; el pie de apoyo cae m√°s adelante y el golpe es m√°s corto.<br>
      - <em>De primera:</em> sin controlar, solo direccion√°s el bal√≥n que viene; necesit√°s anticipaci√≥n.<br><br>

      <strong>Detalles que marcan la diferencia:</strong><br>
      - Pas√° al pie bueno del compa√±ero (evita que tenga que acomodar).<br>
      - Suaviz√° el pase en pista mojada; el bal√≥n patina m√°s.<br>
      - Si hay presi√≥n, pas√° con el interior pero corto: que el receptor te la devuelva enseguida (pase de pared).<br>
      - Para romper l√≠neas, disimul√°: mir√° para un lado y pas√°s para el otro; cambi√° el cuerpo, no solo la cabeza.<br><br>

      <strong>Errores comunes:</strong><br>
      - Tobillo flojo ‚Üí el bal√≥n se va para afuera.<br>
      - Mirar el bal√≥n ‚Üí perd√©s opciones de pase y te llegan encima.<br>
      - Pase sin avisar ‚Üí tu compa√±ero no est√° listo y la pierde.<br>
      - Fuerza excesiva ‚Üí el receptor la tiene que parar, pierde ritmo y llega la marca.<br><br>

      <strong>Ejercicio de pr√°ctica:</strong><br>
      1. Con un compa√±ero, coloc√° dos conos a 5 m. 2. Pas√° y corr√©s al cono de enfrente. 3. Limit√° a dos toques. 4. Hacelo 20 veces sin parar. Si la perd√©s, volv√© al principio.<br><br>

      <strong>Regla de oro:</strong> el pase interior no es solo t√©cnica, es <em>ritmo</em>. Cuanto m√°s r√°pido y justo, menos tiempo tiene la defensa para reorganizarse.
    </p>
  </div>

  <div class="text-center mt-4">
    <button class="btn-leer" onclick="L2.iniciar()">Le√≠do ‚Üí Comenzar test</button>
  </div>

  <div id="testArea"></div>
  <div id="resultArea" class="mt-3"></div>
</div>

<script>
// NAMESPACE √∫nico para lecci√≥n 2
const L2 = {
  preguntas: [],
  idx: 0,
  aciertos: 0,
  timer: null,
  
  volver() { location.href = '/leccion/2'; },
  
  corregir() {
    const sel = document.querySelector('input[name="opt"]:checked');
    if(!sel){ alert("Eleg√≠ una opci√≥n."); return; }
    clearInterval(L2.timer);
    if(parseInt(sel.value) === L2.preguntas[L2.idx].ok) L2.aciertos++;
    L2.idx++;
    if(L2.idx < L2.preguntas.length){ L2.mostrarPregunta(); } else { L2.finalizar(); }
  },
  
  async finalizar() {
    const total = L2.preguntas.length;
    const testArea = document.getElementById('testArea');
    const resultArea = document.getElementById('resultArea');
    
    testArea.innerHTML = '';
    
    if(L2.aciertos === total){
      // ‚úÖ OBTENER jugador_id DE LA URL
      const urlParams = new URLSearchParams(window.location.search);
      const jugadorId = urlParams.get('jugador_id');
      
      if (!jugadorId) {
        resultArea.innerHTML = `
          <div class="alert alert-danger text-center">
            <h4>‚ùå Error</h4>
            <p>No se encontr√≥ el ID del jugador. Cerr√° y volv√© a ingresar tu c√©dula.</p>
          </div>
        `;
        return;
      }
      
      // GUARDAR EN BASE DE DATOS
      try {
        const res = await fetch("/guardar_aprobacion_pg", {
          method: "POST",
          headers: {"Content-Type":"application/json"},
          body: JSON.stringify({
            jugador_id: parseInt(jugadorId), 
            leccion_numero: 2, 
            nota: L2.aciertos
          })
        });
        
        const data = await res.json();
        
        if (data.status === 'ok') {
          // ‚úÖ MOSTRAR √âXITO Y BOT√ìN PARA AVANZAR
          resultArea.innerHTML = `
            <div class="alert alert-success text-center" style="background:#28a745;color:#fff;padding:30px;border-radius:10px;">
              <h2>üéâ ¬°Felicitaciones!</h2>
              <p style="font-size:20px;">Aprobaste con ${L2.aciertos}/${total}</p>
              <p>Lecci√≥n 2 completada correctamente.</p>
              <button class="btn btn-light btn-lg mt-3" style="color:#28a745;font-weight:bold;" onclick="L2.siguienteLeccion()">
                Continuar a Lecci√≥n 3 ‚Üí
              </button>
            </div>
          `;
        } else {
          throw new Error(data.msg || 'Error al guardar');
        }
      } catch (err) {
        resultArea.innerHTML = `
          <div class="alert alert-warning text-center">
            <h4>‚ö†Ô∏è Error al guardar</h4>
            <p>${err.message}</p>
            <button class="btn btn-primary" onclick="location.reload()">Reintentar</button>
          </div>
        `;
      }
      
    } else {
      // ‚ùå NO APROB√ì
      resultArea.innerHTML = `
        <div class="alert alert-warning text-center" style="padding:30px;border-radius:10px;">
          <h3>No aprobaste</h3>
          <p style="font-size:18px;">Obtuviste ${L2.aciertos}/${total}</p>
          <p>Necesit√°s 10/10 para aprobar.</p>
          <button class="btn btn-danger mt-3" onclick="location.reload()">
            ‚Üª Reintentar Lecci√≥n
          </button>
        </div>
      `;
    }
  },
  
  // ‚úÖ FUNCI√ìN CLAVE: AVANZAR A SIGUIENTE LECCI√ìN
  siguienteLeccion() {
    // Enviar mensaje al padre (app.py) para que abra la siguiente lecci√≥n autom√°ticamente
    if (window.parent !== window) {
      window.parent.postMessage({
        tipo: 'leccion_aprobada',
        leccion: 2,
        nota: 10
      }, '*');
    }
  },
  
  iniciar() {
    L2.idx = 0;
    L2.aciertos = 0;
    L2.preguntas = [
      {q:"¬øCon qu√© parte del pie se ejecuta el pase interior?",opts:["Empeine","Interior","Planta","Tal√≥n"],ok:1},
      {q:"¬øC√≥mo debe quedar la cara interna del pie al momento de golpear?",opts:["Hacia arriba","Paralela al objetivo","Hacia abajo","Hacia atr√°s"],ok:1},
      {q:"¬øD√≥nde debe apoyarse el pie de apoyo?",opts:["Detr√°s del bal√≥n","Al costado del bal√≥n","Adelante del bal√≥n","Lejos del bal√≥n"],ok:1},
      {q:"¬øQu√© evit√°s si pas√°s al pie bueno del compa√±ero?",opts:["Que tire de zurda","Que tenga que acomodar","Que se caiga","Que salga corriendo"],ok:1},
      {q:"En pista mojada, ¬øqu√© conviene hacer?",opts:["Pasar m√°s fuerte","Pasar m√°s suave","No pasar","Pasar por arriba"],ok:1},
      {q:"¬øCu√°l es el error de tobillo flojo?",opts:["El bal√≥n sube","El bal√≥n se va para afuera","El bal√≥n se clava","No pasa nada"],ok:1},
      {q:"¬øQu√© pierde tu equipo si mir√°s el bal√≥n al pasar?",opts:["Tiempo","Opciones y ritmo","Goles","La pelota"],ok:1},
      {q:"¬øQu√© es un pase de pared?",opts:["Un pase largo","Un pase y devoluci√≥n r√°pida","Un pase en l√≠nea","Un pase al arco"],ok:1},
      {q:"¬øCu√°ntos toques m√°ximos se recomiendan en el ejercicio de pr√°ctica?",opts:["Uno","Dos","Tres","Cuatro"],ok:1},
      {q:"¬øQu√© define el pase interior adem√°s de la t√©cnica?",opts:["La fuerza","El ritmo","La punter√≠a","La velocidad"],ok:1}
    ];
    L2.mostrarTest();
  },
  
  mostrarTest() {
    document.querySelector('.btn-leer').style.display = 'none';
    L2.mostrarPregunta();
  },
  
  mostrarPregunta(){
    const p = L2.preguntas[L2.idx];
    let html = `<div class="timer-bar"><div class="timer-fill" style="width:100%"></div></div>
                <b style="color:#00ff00;">Pregunta ${L2.idx+1}/10</b> ‚Äì <span style="color:#fff;">${p.q}</span><br><small id="countdown" style="color:#ffff00;">12s</small><div class="mt-2">`;
    p.opts.forEach((o,k)=> html += `
      <div class="opcion">
        <input type="radio" name="opt" id="o${k}" value="${k}">
        <label for="o${k}">${o}</label>
      </div>`);
    html += `</div><button class="btn btn-primary btn-sm mt-2" style="background:#415a77;color:#ffff00;border:none;padding:10px 20px;border-radius:5px;cursor:pointer;margin-top:15px;" onclick="L2.corregir()">Siguiente</button>`;
    document.getElementById('testArea').innerHTML = html;

    let seg = 12;
    const bar = document.querySelector('.timer-fill');
    const txt = document.getElementById('countdown');
    L2.timer = setInterval(()=>{
      seg--;
      bar.style.width = (seg/12*100) + '%';
      txt.textContent = seg + 's';
      if(seg === 0){ clearInterval(L2.timer); L2.timeOut(); }
    },1000);
  },
  
  timeOut(){
    alert("Se acab√≥ el tiempo. Volv√© a intentarlo.");
    L2.volver();
  }
};
</script>
</body>
</html>